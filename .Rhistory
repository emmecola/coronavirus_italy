#
# }
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
edit(summary)
# CLEAN DATA
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank())
ggsave('plot_Italy.png',ITALYPLOT,dev="png",limitsize=TRUE, bg='transparent')
for (myregion in unique(summary$Regione))
{
if(myregion %in% c('Bolzano','Trento')) {
myregion_name = paste('nella Provincia Autonoma di ',myregion, sep="")} else if (myregion=="Marche") {
myregion_name = paste('nelle ',myregion,sep="")
} else {
myregion_name = paste('in ',myregion,sep="")
}
REGIONPLOT <- ggplot(data=summary[summary$Regione==myregion,], mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 ",myregion_name," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
scale_y_continuous(position="right") + labs(x="",y="")
ggsave(paste("plot_",gsub(" ","_",myregion),".png",sep=""),REGIONPLOT,limitsize=TRUE, bg='transparent')
}
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
edit(summary)
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","totale_casi","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Regione']
summary_others <- summary[summary$Regione %in% collapse_these,]
summary_top <- summary[!(summary$Regione %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Regione="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Regione']),summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Casi'],.desc=TRUE),"Altre")
REGION_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Regione,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Set1") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per regione (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
geom_area()
ggsave('plot_Regions.png',REGION_CONTRIBUTION,dev="png",limitsize=TRUE, bg='transparent')
### PROVINCES ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province.csv'
# LOAD DATA
summary_table <- read.csv(summary_file)
summary_table$data <- as.Date(summary_table$data)
summary_table$data <- as.Date(format(summary_table$data,format='%Y-%m-%d'))
today <- max(summary_table$data)
kept <- c("denominazione_provincia","totale_casi","data")
summary <- summary_table[,kept]
summary <- melt(summary, id=c("denominazione_provincia","data"))
colnames(summary) <- c("Provincia","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
summary_others <- summary[summary$Provincia %in% collapse_these,]
summary_top <- summary[!(summary$Provincia %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Paired") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per provincia (agg.",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
geom_area()
ggsave('plot_Provinces.png',PROVINCE_CONTRIBUTION,dev="png", bg='transparent')
#
# for (myregion in unique(summary_table$denominazione_regione))
#
# {
#
#   summary = summary_table[summary_table$denominazione_regione == myregion,]
#
# kept <- c("denominazione_provincia","totale_casi","data")
# summary <- summary[,kept]
# summary <- melt(summary, id=c("denominazione_provincia","data"))
#
# colnames(summary) <- c("Provincia","Data","Categoria","Casi")
#
# Today_TOT <- sum(summary[summary$Data == today,'Casi'])
#
# print(Today_TOT)
#
# collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
# print(myregion)
# print(collapse_these)
#
# summary_others <- summary[summary$Provincia %in% collapse_these,]
# summary_top <- summary[!(summary$Provincia %in% collapse_these),]
#
# summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
# summary_full <- rbind(summary_top,summary_others)
#
# level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
#
# PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
#   scale_fill_brewer("",palette = "Paired") +
#   scale_y_continuous(position="right") + labs(x="",y="") +
#   ggtitle(paste("SARS-COV-2 in ", myregion," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
#   scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
#   theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
#   geom_area()
#
# ggsave(paste("plot_",str_replace(myregion," ","_"),"_byProvince.png",sep=""), PROVINCE_CONTRIBUTION,dev="png", bg='transparent')
#
# }
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
edit(summary)
# CLEAN DATA
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank())
ggsave('plot_Italy.png',ITALYPLOT,dev="png",limitsize=TRUE, bg='transparent')
for (myregion in unique(summary$Regione))
{
if(myregion %in% c('Bolzano','Trento')) {
myregion_name = paste('nella Provincia Autonoma di ',myregion, sep="")} else if (myregion=="Marche") {
myregion_name = paste('nelle ',myregion,sep="")
} else {
myregion_name = paste('in ',myregion,sep="")
}
REGIONPLOT <- ggplot(data=summary[summary$Regione==myregion,], mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 ",myregion_name," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
scale_y_continuous(position="right") + labs(x="",y="")
ggsave(paste("plot_",gsub(" ","_",myregion),".png",sep=""),REGIONPLOT,limitsize=TRUE, bg='transparent')
}
### REGION ANALYSIS
### REGION ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
edit(summary)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","totale_casi","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Regione']
summary_others <- summary[summary$Regione %in% collapse_these,]
summary_top <- summary[!(summary$Regione %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Regione="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Regione']),summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Casi'],.desc=TRUE),"Altre")
REGION_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Regione,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Set1") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per regione (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
geom_area()
ggsave('plot_Regions.png',REGION_CONTRIBUTION,dev="png",limitsize=TRUE, bg='transparent')
### PROVINCES ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province.csv'
# LOAD DATA
summary_table <- read.csv(summary_file)
edit(summary_table)
summary_table$data <- as.Date(summary_table$data)
summary_table$data <- as.Date(format(summary_table$data,format='%Y-%m-%d'))
today <- max(summary_table$data)
kept <- c("denominazione_provincia","totale_casi","data")
summary <- summary_table[,kept]
summary <- melt(summary, id=c("denominazione_provincia","data"))
colnames(summary) <- c("Provincia","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
summary_others <- summary[summary$Provincia %in% collapse_these,]
summary_top <- summary[!(summary$Provincia %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Paired") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per provincia (agg.",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
geom_area()
ggsave('plot_Provinces.png',PROVINCE_CONTRIBUTION,dev="png", bg='transparent')
#
# for (myregion in unique(summary_table$denominazione_regione))
#
# {
#
#   summary = summary_table[summary_table$denominazione_regione == myregion,]
#
# kept <- c("denominazione_provincia","totale_casi","data")
# summary <- summary[,kept]
# summary <- melt(summary, id=c("denominazione_provincia","data"))
#
# colnames(summary) <- c("Provincia","Data","Categoria","Casi")
#
# Today_TOT <- sum(summary[summary$Data == today,'Casi'])
#
# print(Today_TOT)
#
# collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
# print(myregion)
# print(collapse_these)
#
# summary_others <- summary[summary$Provincia %in% collapse_these,]
# summary_top <- summary[!(summary$Provincia %in% collapse_these),]
#
# summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
# summary_full <- rbind(summary_top,summary_others)
#
# level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
#
# PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
#   scale_fill_brewer("",palette = "Paired") +
#   scale_y_continuous(position="right") + labs(x="",y="") +
#   ggtitle(paste("SARS-COV-2 in ", myregion," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
#   scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
#   theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
#   geom_area()
#
# ggsave(paste("plot_",str_replace(myregion," ","_"),"_byProvince.png",sep=""), PROVINCE_CONTRIBUTION,dev="png", bg='transparent')
#
# }
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(showtext)
# ACTIVATE SHOWTEXT
showtext_auto()
x11()
# LOAD FONT
font_add(family='Roboto', regular='C:/Users/asus/Downloads/Roboto/Roboto-Light.ttf')
#font_add(family='Sen', regular='C:/Users/colaiacovo.moreno/Downloads/Sen/Sen-Regular.ttf')
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$denominazione_regione <- gsub('^Trento', 'P.A. Trento', summary$denominazione_regione)
summary$denominazione_regione <- gsub('^Bolzano', 'P.A. Bolzano', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("COVID-19 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
for (myregion in unique(summary$Regione))
{
if(myregion %in% c('P.A. Bolzano','P.A. Trento')) {
myregion_name = paste('nella Provincia Autonoma di ',strsplit(myregion,' ')[[1]][2], sep="")} else if (myregion=="Marche") {
myregion_name = paste('nelle ',myregion,sep="")
} else {
myregion_name = paste('in ',myregion,sep="")
}
REGIONPLOT <- ggplot(data=summary[summary$Regione==myregion,], mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("COVID-19 in ",myregion_name," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave(paste("img/plot_",gsub(" ","_",myregion),".png",sep=""),REGIONPLOT, width = 11, height = 8, units='in', bg='transparent')
}
### REGION ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$denominazione_regione <- gsub('^Trento', 'P.A. Trento', summary$denominazione_regione)
summary$denominazione_regione <- gsub('^Bolzano', 'P.A. Bolzano', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","totale_casi","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT*0.03),'Regione']
summary_others <- summary[summary$Regione %in% collapse_these,]
summary_top <- summary[!(summary$Regione %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Regione="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Regione']),summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Casi'],.desc=TRUE),"Altre")
test <- summary_full[(summary_full$Casi>1000)&(summary_full$Regione!="Altre"),]
for (myregion in unique(test$Regione))
{
test[test$Regione==myregion,"PrimoGiorno"] = min(test[test$Regione==myregion,"Data"])
}
test$Giorno <- test$Data-test$PrimoGiorno
TREND_PLOT <- ggplot(data=test,aes(x=Giorno,y=Casi,group=Regione)) +
geom_line(size=1,aes(color=factor(Regione,levels=levels(level_order)))) + geom_point(size=3,aes(color=factor(Regione,levels=levels(level_order)))) +
scale_color_brewer("",palette = "Paired") +
ggtitle(paste("COVID-19 in Italia, regioni con più casi (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
labs(x="Giorni trascorsi dal caso numero 1000",y="") +
scale_y_continuous(trans='log10',position="right") + annotation_logticks(sides='r') +
theme_classic() +
theme(legend.title = element_blank(),
legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
axis.title=element_text(size=45,family="Roboto",margin = unit(c(3, 0, 0, 0), "cm")),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave('img/trend_Regions.png',TREND_PLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
REGION_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Regione,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Paired") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("COVID-19 in Italia, casi per regione (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
geom_area() +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave('img/plot_Regions.png',REGION_CONTRIBUTION,dev="png", width = 11, height = 8, units='in', bg='transparent')
### PROVINCES ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province.csv'
#summary_file <- 'C:/Users/asus/Downloads/dpc-covid19-ita-province.csv'
# LOAD DATA
summary_table <- read.csv(summary_file)
summary_table <- summary_table[!is.na(summary_table$totale_casi),]
summary_table$data <- as.Date(summary_table$data)
summary_table$data <- as.Date(format(summary_table$data,format='%Y-%m-%d'))
today <- max(summary_table$data)
kept <- c("denominazione_provincia","totale_casi","data")
summary <- summary_table[,kept]
summary <- melt(summary, id=c("denominazione_provincia","data"))
colnames(summary) <- c("Provincia","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT*0.03),'Provincia']
summary_others <- summary[summary$Provincia %in% collapse_these,]
summary_top <- summary[!(summary$Provincia %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
test <- summary_full[(summary_full$Casi>=100)&(summary_full$Provincia!="Altre"),]
for (myprovince in unique(test$Provincia))
{
test[test$Provincia==myprovince,"PrimoGiorno"] = min(test[test$Provincia==myprovince,"Data"])
}
test$Giorno <- test$Data-test$PrimoGiorno
TREND_PLOT <- ggplot(data=test,aes(x=Giorno,y=Casi,group=Provincia)) +
geom_line(size=1,aes(color=factor(Provincia,levels=levels(level_order)))) + geom_point(size=3,aes(color=factor(Provincia,levels=levels(level_order)))) +
scale_color_brewer("",palette = "Paired") +
ggtitle(paste("COVID-19 in Italia, province con più casi (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
labs(x="Giorni trascorsi dal caso numero 100",y="") +
scale_y_continuous(trans='log10', position="right") + annotation_logticks(sides='r') +
theme_classic() +
theme(legend.title = element_blank(),
legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
axis.title=element_text(size=45,family="Roboto",margin = unit(c(3, 0, 0, 0), "cm")),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave('img/trend_Provinces.png',TREND_PLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Paired") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("COVID-19 in Italia, casi per provincia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
geom_area() +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
plot.margin=unit(c(1,0,1,0.5),"cm"),
legend.text=element_text(size=45,family='Roboto'),
plot.title = element_text(size=60, family='Roboto'),
axis.text.x = element_text(size=40,family='Roboto'),
axis.text.y = element_text(size=40,family='Roboto'))
ggsave('img/plot_Provinces.png',PROVINCE_CONTRIBUTION,dev="png", width = 11, height = 8, units='in', bg='transparent')
# TURN OFF SHOWTEXT
showtext_auto(FALSE)
