summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 200, label = total, fill = NULL), data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 300, label = total, fill = NULL), size=10, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 300, label = total, fill = NULL), size=5, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 300, label = total, fill = NULL), size=5, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 300, label = total, fill = NULL), size=3, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 500, label = total, fill = NULL), size=5, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 400, label = total, fill = NULL), size=4, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
# SET WORKING DIRECTORY
setwd("~/GIT_folder/coronavirus_italy")
# LOAD LIBRARIES
library(dplyr)
library(ggplot2)
library(reshape2)
library(forcats)
library(extrafont)
loadfonts(device = "win")
# INPUT FILE
summary_file <- summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","ricoverati_con_sintomi","terapia_intensiva",
"isolamento_domiciliare","dimessi_guariti","deceduti","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
levels(summary$Categoria) <- c("Ricoverati con sintomi","Terapia intensiva","Isolamento domiciliare","Dimessi guariti", "Deceduti")
colormap <- c("Ricoverati con sintomi" = "darkorange1",
"Terapia intensiva" = "firebrick2",
"Isolamento domiciliare" = "deepskyblue3",
"Dimessi guariti" = "#50C878",
"Deceduti" = "grey35")
totals <- summary %>%
group_by(Data) %>%
summarize(total = sum(Casi))
ITALYPLOT <- ggplot(data=summary, mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 in Italia (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 400, label = total, fill = NULL), size=4, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Italy.png',ITALYPLOT,dev="png", width = 11, height = 8, units='in', bg='transparent')
for (myregion in unique(summary$Regione))
{
if(myregion %in% c('P.A. Bolzano','P.A. Trento')) {
myregion_name = paste('nella Provincia Autonoma di ',strsplit(myregion,' ')[[1]][2], sep="")} else if (myregion=="Marche") {
myregion_name = paste('nelle ',myregion,sep="")
} else {
myregion_name = paste('in ',myregion,sep="")
}
totals <- summary[summary$Regione==myregion,] %>%
group_by(Data) %>%
summarize(total = sum(Casi))
REGIONPLOT <- ggplot(data=summary[summary$Regione==myregion,], mapping=aes(x=Data, y=Casi, fill=factor(Categoria, levels = c("Dimessi guariti","Isolamento domiciliare","Ricoverati con sintomi","Terapia intensiva","Deceduti")))) +
geom_bar(stat="identity") +
scale_fill_manual("", values = colormap) +
ggtitle(paste("SARS-COV-2 ",myregion_name," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
scale_y_continuous(position="right") + labs(x="",y="") +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 400, label = total, fill = NULL), size=4, family='HelveticaNeueforSAS Light', data = totals)
ggsave(paste("img/plot_",gsub(" ","_",myregion),".png",sep=""),REGIONPLOT, width = 11, height = 8, units='in', bg='transparent')
}
### REGION ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv'
# LOAD DATA
summary <- read.csv(summary_file)
# CLEAN DATA
summary$denominazione_regione <- gsub('Friuli V. G. ', 'Friuli Venezia Giulia', summary$denominazione_regione)
summary$data <- as.Date(summary$data)
summary$data <- as.Date(format(summary$data,format='%Y-%m-%d'))
today <- max(summary$data)
kept <- c("denominazione_regione","totale_casi","data")
summary <- summary[,kept]
summary <- melt(summary, id=c("denominazione_regione","data"))
colnames(summary) <- c("Regione","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Regione']
summary_others <- summary[summary$Regione %in% collapse_these,]
summary_top <- summary[!(summary$Regione %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Regione="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Regione']),summary_full[(summary_full$Data==today)&(summary_full$Regione!="Altre"),'Casi'],.desc=TRUE),"Altre")
totals <- summary_full %>%
group_by(Data) %>%
summarize(total = sum(Casi))
REGION_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Regione,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Set1") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per regione (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
geom_area() +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 400, label = total, fill = NULL), size=4, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Regions.png',REGION_CONTRIBUTION,dev="png", width = 11, height = 8, units='in', bg='transparent')
### PROVINCES ANALYSIS
# INPUT FILE
summary_file <- 'https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province.csv'
# LOAD DATA
summary_table <- read.csv(summary_file)
summary_table <- summary_table[!is.na(summary_table$totale_casi),]
summary_table$data <- as.Date(summary_table$data)
summary_table$data <- as.Date(format(summary_table$data,format='%Y-%m-%d'))
today <- max(summary_table$data)
kept <- c("denominazione_provincia","totale_casi","data")
summary <- summary_table[,kept]
summary <- melt(summary, id=c("denominazione_provincia","data"))
colnames(summary) <- c("Provincia","Data","Categoria","Casi")
Today_TOT <- sum(summary[summary$Data == today,'Casi'])
collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
summary_others <- summary[summary$Provincia %in% collapse_these,]
summary_top <- summary[!(summary$Provincia %in% collapse_these),]
summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
summary_full <- rbind(summary_top,summary_others)
level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
totals <- summary_full %>%
group_by(Data) %>%
summarize(total = sum(Casi))
PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
scale_fill_brewer("",palette = "Paired") +
scale_y_continuous(position="right") + labs(x="",y="") +
ggtitle(paste("SARS-COV-2 in Italia, casi per provincia (agg.",format(today,"%d/%m/%y"),")",sep="")) +
scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
geom_area() +
theme_classic() +
theme(legend.position="bottom",
legend.background = element_rect(color = NA),
panel.grid.major = element_line(colour = 'grey',size=0.3),
panel.grid.minor = element_blank(),
panel.grid.major.x=element_blank(),
legend.text=element_text(size=15,family='HelveticaNeueforSAS Light'),
plot.title = element_text(size=19, family='HelveticaNeueforSAS Light'),
axis.text.x = element_text(size=13,family='HelveticaNeueforSAS Light'),
axis.text.y = element_text(size=13,family='HelveticaNeueforSAS Light')) +
geom_text(aes(Data, total + 400, label = total, fill = NULL), size=4, family='HelveticaNeueforSAS Light', data = totals)
ggsave('img/plot_Provinces.png',PROVINCE_CONTRIBUTION,dev="png", width = 11, height = 8, units='in', bg='transparent')
#
# for (myregion in unique(summary_table$denominazione_regione))
#
# {
#
#   summary = summary_table[summary_table$denominazione_regione == myregion,]
#
# kept <- c("denominazione_provincia","totale_casi","data")
# summary <- summary[,kept]
# summary <- melt(summary, id=c("denominazione_provincia","data"))
#
# colnames(summary) <- c("Provincia","Data","Categoria","Casi")
#
# Today_TOT <- sum(summary[summary$Data == today,'Casi'])
#
# print(Today_TOT)
#
# collapse_these <- summary[(summary$Data == today)&(summary$Casi<=Today_TOT/20),'Provincia']
# print(myregion)
# print(collapse_these)
#
# summary_others <- summary[summary$Provincia %in% collapse_these,]
# summary_top <- summary[!(summary$Provincia %in% collapse_these),]
#
# summary_others <- summary_others[,c('Data','Casi')] %>% group_by(Data) %>% summarise_all(funs(sum)) %>% mutate(Provincia="Altre") %>% mutate(Categoria="totale_casi")
# summary_full <- rbind(summary_top,summary_others)
#
# level_order <- fct_expand(fct_reorder(factor(summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Provincia']),summary_full[(summary_full$Data==today)&(summary_full$Provincia!="Altre"),'Casi'],.desc=TRUE),"Altre")
#
# PROVINCE_CONTRIBUTION <- ggplot(summary_full, aes(x=Data, y=Casi, fill=factor(Provincia,levels=levels(level_order)))) +
#   scale_fill_brewer("",palette = "Paired") +
#   scale_y_continuous(position="right") + labs(x="",y="") +
#   ggtitle(paste("SARS-COV-2 in ", myregion," (agg. ",format(today,"%d/%m/%y"),")",sep="")) +
#   scale_x_date(date_labels="%d/%m", date_breaks="2 days") +
#   theme(legend.position="bottom", legend.background = element_rect(color = NA), panel.grid.minor = element_blank()) +
#   geom_area()
#
# ggsave(paste("plot_",str_replace(myregion," ","_"),"_byProvince.png",sep=""), PROVINCE_CONTRIBUTION,dev="png", bg='transparent')
#
# }
